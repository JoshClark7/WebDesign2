(()=>{"use strict";var e,t,n,r,o,c,a,i,l=Object.freeze({gain:.5,numSamples:256}),u=(new Uint8Array(l.numSamples/2),function(e){t.src=e}),s=function(){if(document.querySelector("#cb-treble").checked){c.frequency.setValueAtTime(1e3,e.currentTime);var t=Number(document.querySelector("#slider-treble").value)/100*25;c.gain.setValueAtTime(t,e.currentTime)}else c.gain.setValueAtTime(0,e.currentTime)},d=function(){if(document.querySelector("#cb-bass").checked){a.frequency.setValueAtTime(1e3,e.currentTime);var t=Number(document.querySelector("#slider-bass").value)/100*25;a.gain.setValueAtTime(t,e.currentTime)}else a.gain.setValueAtTime(0,e.currentTime)},f=function(){if(document.querySelector("#cb-distortion").checked){i.curve=null;var e=Number(document.querySelector("#slider-distortion").value)/100*25;i.curve=h(e)}else i.curve=null},h=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=new Float32Array(256),n=0;n<256;++n){var r=2*n/256-1;t[n]=(Math.PI+e)*r/(Math.PI+e*Math.abs(r))}return t};function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var y,b,v,g,p,S,w=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return"rgba(".concat(e,",").concat(t,",").concat(n,",").concat(r,")")};function q(e){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q(e)}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,P(r.key),r)}}function P(e){var t=function(e,t){if("object"!==q(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==q(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===q(t)?t:String(t)}var A,T,M,E,I=[],R=0,C=0,F=function(e,t){y=e.getContext("2d"),b=e.width,v=e.height,g=function(e,t,n,r,o,c){var a,i=e.createLinearGradient(0,0,0,o),l=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,a=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,c=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw c}}}}([{percent:0,color:"black"},{percent:.25,color:"black"},{percent:.5,color:"gray"},{percent:1,color:"magenta"}]);try{for(l.s();!(a=l.n()).done;){var u=a.value;i.addColorStop(u.percent,u.color)}}catch(e){l.e(e)}finally{l.f()}return i}(y,0,0,0,v),p=t,S=new Uint8Array(p.fftSize/2),A=Date.now()},j=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t,this.y=n,this.strength=r,this.timer=0,this.sizeMult=1,this.lastUpdate=Date.now(),this.finished=!1}var t,n;return t=e,n=[{key:"update",value:function(){var e=Date.now(),t=e-this.lastUpdate;this.timer+=t/1e3,this.lastUpdate=e,this.timer>this.strength&&(this.finished=!0)}},{key:"draw",value:function(e){var t=50*this.timer*(this.strength*this.strength/2);e.save(),e.beginPath(),e.lineWidth=7*this.timer/this.strength,e.strokeStyle=w(255,255,255,1-this.timer/this.strength),e.arc(b/2,v/2,t,0,2*Math.PI,!1),e.stroke(),e.closePath(),e.restore()}}],n&&k(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();T=j,E="Pulse",(M=P(M="type"))in T?Object.defineProperty(T,M,{value:E,enumerable:!0,configurable:!0,writable:!0}):T[M]=E;var z={showGradient:!0,showBars:!0,showCircles:!0,showNoise:!1,showInvert:!1,showEmboss:!1,mode:2,isPlaying:!1},D=Object.freeze({sound1:"media/New Adventure Theme.mp3"}),N=function(){var h,m;console.log("init called"),console.log("Testing utils.getRandomColor() import: ".concat("rgba(".concat((m=function(){return 185*Math.random()+35})(),",").concat(m(),",").concat(m(),",1)"))),h=D.sound1,t=new Audio,e=new(window.AudioContext||window.webkitAudioContex),u(h),n=e.createMediaElementSource(t),r=e.createAnalyser(),(c=e.createBiquadFilter()).type="highshelf",(a=e.createBiquadFilter()).type="lowshelf",i=e.createWaveShaper(),r.fftSize=l.numSamples,(o=e.createGain()).gain.value=l.gain,n.connect(o),o.connect(c),c.connect(a),a.connect(i),i.connect(r),r.connect(e.destination),document.querySelector("#cb-treble").checked=!1,document.querySelector("#cb-bass").checked=!1,document.querySelector("#cb-distortion").checked=!1,d(),s(),f();var y=document.querySelector("canvas");x(y),F(y,r),B()},x=function(n){var r=document.querySelector("#button-fs"),c=document.querySelector("#button-mode"),a=document.querySelector("#cb-gradient"),i=document.querySelector("#cb-bars"),l=document.querySelector("#cb-circles"),h=document.querySelector("#cb-noise"),m=document.querySelector("#cb-invert"),y=document.querySelector("#cb-emboss"),b=document.querySelector("#button-play"),v=document.querySelector("#cb-bass"),g=document.querySelector("#cb-treble"),p=document.querySelector("#cb-distortion");a.checked=!0,i.checked=!0,l.checked=!0,h.checked=!1,r.onclick=function(e){var t;console.log("init called"),(t=n).requestFullscreen?t.requestFullscreen():t.mozRequestFullscreen?t.mozRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()},c.onclick=function(e){1==z.mode?z.mode=2:2==z.mode&&(z.mode=1)},a.onchange=function(e){z.showGradient=a.checked},i.onchange=function(e){z.showBars=i.checked},l.onchange=function(e){z.showCircles=l.checked},h.onchange=function(e){z.showNoise=h.checked},m.onchange=function(e){z.showInvert=m.checked},y.onchange=function(e){z.showEmboss=y.checked},v.onchange=function(e){d()},g.onchange=function(e){s()},p.onchange=function(e){f()},b.onclick=function(n){console.log("audioCtx,state before = ".concat(e.stat)),"suspended"==e.state&&e.resume(),console.log("audioCtx,state after = ".concat(e.stat)),"no"==n.target.dataset.playing?(t.play(),n.target.dataset.playing="yes",z.isPlaying=!0):(t.pause(),n.target.dataset.playing="no",z.isPlaying=!1)};var S=document.querySelector("#slider-volume"),w=document.querySelector("#label-volume"),q=document.querySelector("#slider-bass"),k=document.querySelector("#label-bass"),P=document.querySelector("#slider-treble"),A=document.querySelector("#label-treble"),T=document.querySelector("#slider-distortion"),M=document.querySelector("#label-distortion");S.oninput=function(e){!function(e){e=Number(e)/5,o.gain.value=e}(e.target.value),w.innerHTML=Math.round(e.target.value/2*100)},S.dispatchEvent(new Event("input")),q.oninput=function(e){d(),k.innerHTML=Math.round(e.target.value)},q.dispatchEvent(new Event("input")),P.oninput=function(e){s(),A.innerHTML=Math.round(e.target.value)},P.dispatchEvent(new Event("input")),T.oninput=function(e){f(),M.innerHTML=Math.round(e.target.value)},T.dispatchEvent(new Event("input")),document.querySelector("#select-track").onchange=function(e){u(e.target.value),"yes"==b.dataset.playing&&b.dispatchEvent(new MouseEvent("click"))}},B=function e(){setTimeout(e),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(1==e.mode?p.getByteFrequencyData(S):2==e.mode&&p.getByteTimeDomainData(S),y.save(),y.fillStyle="black",y.globalAlpha=.1,y.fillRect(0,0,b,v),y.restore(),e.showGradient&&(y.save(),y.fillStyle=g,y.globalAlpha=.3,y.fillRect(0,0,b,v),y.restore()),e.showBars){var t=(b-4*S.length-10)/S.length;y.save(),y.fillStyle="rgba(255, 255, 255, 0.50)",y.strokeStyle="rgba(200, 200, 200, 0.50)";for(var n=0;n<S.length;n++)1==e.mode?(y.fillRect(5+n*(t+4),356-S[n]/2,t,200),y.strokeRect(5+n*(t+4),356-S[n]/2,t,200)):2==e.mode&&(y.fillStyle="rgba(255, 255, 255, 0.50)",y.fillRect(5+n*(t+4),224-S[n],t,100),y.fillStyle="rgba(0, 0, 0, 0.50)",y.fillRect(5+n*(t+4),328-S[n],t,100));y.restore()}for(var r=0;r<R;r++)null!=I[r]&&(I[r].update(),I[r].draw(y),I[r].finished&&(I[r]=void 0));if(e.isPlaying){var o=Date.now();if(C+=(o-A)/1e3,A=o,y.save(),y.globalAlpha=.5,C>=.1){var c=S[5]/255*5;I[R]=new j(b/2,v/2,c),console.log(c),R++,C=0}}if(e.showCircles){for(var a=v/4,i=0;i<S.length;i++){var l=S[i]/255,u=l*a;y.beginPath(),y.fillStyle=w(100,100,100,.34-l/3),y.arc(b/2,v/2,u,0,2*Math.PI,!1),y.fill(),y.closePath(),y.beginPath(),y.fillStyle=w(0,0,0,.1-l/10),y.arc(b/2,v/2,1.5*u,0,2*Math.PI,!1),y.fill(),y.closePath(),y.save(),y.beginPath(),y.fillStyle=w(200,200,200,.5-l/5),y.arc(b/2,v/2,.5*u,0,2*Math.PI,!1),y.fill(),y.closePath(),y.restore()}y.restore()}for(var s=y.getImageData(0,0,b,v),d=s.data,f=d.length,h=s.width,m=0;m<f;m+=4)Math.random()<.05&&e.showNoise&&(d[m]=d[m+1]=d[m+2]=0,d[m]=255),e.showInvert&&(d[m]=255-d[m],d[m+1]=255-d[m+1],d[m+2]=255-d[m+2]);if(e.showEmboss)for(var q=0;q<f;q++)q%4!=3&&(d[q]=127+2*d[q]-d[q+4]-d[q+4*h]);y.putImageData(s,0,0)}(z)};window.onload=function(){console.log("window.onload called"),N()}})();